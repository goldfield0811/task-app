<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚·ãƒ³ãƒ—ãƒ«ã‚¿ã‚¹ã‚¯ç®¡ç†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWAç”¨ -->
  <meta name="theme-color" content="#2563eb" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="icons/icon-192.png" />

  <!-- Firebase compat SDK èª­ã¿è¾¼ã¿ -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>

  <style>
    /* ---------------------------------------------
       ğŸ¨ ãƒ†ãƒ¼ãƒç”¨CSSå¤‰æ•°ï¼ˆãƒ©ã‚¤ãƒˆ / ãƒ€ãƒ¼ã‚¯ï¼‰
    --------------------------------------------- */
    :root {
      --bg: #f5f5f7;
      --text-main: #333333;
      --card-bg: #ffffff;
      --border-subtle: #e5e7eb;
      --shadow-soft: 0 2px 6px rgba(0, 0, 0, 0.06);
      --btn-primary-bg: #2563eb;
      --btn-primary-border: #2563eb;
      --btn-primary-text: #ffffff;
      --btn-primary-bg-hover: #1d4ed8;
    }

    :root[data-theme="dark"] {
      --bg: #0f172a;
      --text-main: #e5e7eb;
      --card-bg: #1f2937;
      --border-subtle: #374151;
      --shadow-soft: 0 2px 8px rgba(0, 0, 0, 0.6);
      --btn-primary-bg: #3b82f6;
      --btn-primary-border: #3b82f6;
      --btn-primary-text: #f9fafb;
      --btn-primary-bg-hover: #2563eb;
    }

    /* ---------------------------------------------
       ğŸ¨ åŸºæœ¬ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
    --------------------------------------------- */
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .app {
      max-width: 960px;
      margin: 0 auto;
      padding: 1rem;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    header h1 {
      margin: 0;
      font-size: 1.4rem;
    }

    .filters {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      font-size: 0.9rem;
    }
    .filters select {
      padding: 0.2rem 0.4rem;
    }

    .main {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    @media (min-width: 768px) {
      .main {
        flex-direction: row;
        align-items: flex-start;
      }
    }

    /* ---------------------------------------------
       ğŸ¨ ã‚«ãƒ¼ãƒ‰ï¼ˆã‚«ãƒ¼ãƒ‰èƒŒæ™¯ / æ ç·šï¼‰
    --------------------------------------------- */
    .card {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 0.8rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
    }

    /* ---------------------------------------------
       ğŸ¨ ãƒœã‚¿ãƒ³é¡ï¼ˆãƒ†ãƒ¼ãƒå¯¾å¿œï¼‰
    --------------------------------------------- */
    button {
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 0.2rem 0.5rem;
      font-size: 0.8rem;
      cursor: pointer;
      background: #fafafa;
      color: var(--text-main);
    }
    button:hover {
      background: #f0f0f0;
    }

    :root[data-theme="dark"] button {
      background: #111827;
      border-color: #4b5563;
    }
    :root[data-theme="dark"] button:hover {
      background: #1f2937;
    }

    .btn-primary {
      border-color: var(--btn-primary-border);
      background: var(--btn-primary-bg);
      color: var(--btn-primary-text);
    }
    .btn-primary:hover {
      background: var(--btn-primary-bg-hover);
    }

    .btn-danger {
      border-color: #e53935;
      color: #e53935;
      background: #fff5f5;
    }
    .btn-danger:hover {
      background: #ffebee;
    }

    .btn-secondary {
      border-color: #999;
      color: var(--text-main);
    }

    /* ---------------------------------------------
       ğŸ¨ ã‚¿ã‚¹ã‚¯ä¸€è¦§
    --------------------------------------------- */
    .task-list {
      flex: 1;
      max-height: 70vh;
      overflow-y: auto;
    }
    .task-form {
      flex: 1;
    }

    .task-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    ul#task-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .task-item {
      border-bottom: 1px solid var(--border-subtle);
      padding: 0.5rem 0;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }
    .task-item:last-child {
      border-bottom: none;
    }

    .task-main-row {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      align-items: center;
    }
    .task-title {
      font-weight: 600;
    }

    .task-meta {
      font-size: 0.78rem;
      color: #777;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    /* ãƒãƒƒã‚¸ */
    .badge {
      display: inline-block;
      padding: 0.1rem 0.4rem;
      border-radius: 999px;
      font-size: 0.7rem;
    }

    .badge-priority-low { background: #e0f2ff; color: #1565c0; }
    .badge-priority-medium { background: #fff4e0; color: #e65100; }
    .badge-priority-high { background: #ffe0e0; color: #c62828; }

    .badge-status-todo { background: #e0f7fa; color: #00838f; }
    .badge-status-doing { background: #ede7f6; color: #4527a0; }
    .badge-status-done { background: #e8f5e9; color: #2e7d32; }

    .task-actions {
      display: flex;
      gap: 0.25rem;
      margin-top: 0.2rem;
    }

    /* ---------------------------------------------
       ğŸ¨ Formï¼ˆãƒ†ãƒ¼ãƒå¯¾å¿œï¼‰
    --------------------------------------------- */
    form label {
      display: block;
      font-size: 0.8rem;
      margin-top: 0.4rem;
      margin-bottom: 0.1rem;
    }
    form input[type="text"],
    form input[type="email"],
    form input[type="password"],
    form input[type="date"],
    form select,
    form textarea {
      width: 100%;
      padding: 0.3rem 0.4rem;
      font-size: 0.9rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: var(--card-bg);
      color: var(--text-main);
    }
    form textarea {
      min-height: 80px;
      resize: vertical;
    }

    .form-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.6rem;
      justify-content: flex-end;
    }

    /* ---------------------------------------------
       ğŸ¨ Authã‚»ã‚¯ã‚·ãƒ§ãƒ³
    --------------------------------------------- */
    #auth-section { margin-bottom: 1rem; }
    #auth-user-email { color: var(--text-main); }

    .theme-toggle {
      min-width: 2rem;
      height: 2rem;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

  </style>
</head>

<body>
  <div class="app">

    <!-- ====== ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± ====== -->
    <section class="card" id="auth-section">
      <h2>ãƒ­ã‚°ã‚¤ãƒ³</h2>

      <!-- æœªãƒ­ã‚°ã‚¤ãƒ³ -->
      <div id="auth-logged-out">
        <label for="auth-email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input type="email" id="auth-email" placeholder="example@example.com" />

        <label for="auth-password" style="margin-top:0.4rem;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" id="auth-password" placeholder="6æ–‡å­—ä»¥ä¸Š" />

        <div style="margin-top:0.6rem; display:flex; gap:0.5rem; justify-content:flex-end;">
          <button type="button" id="btn-signup">æ–°è¦ç™»éŒ²</button>
          <button type="button" id="btn-login" class="btn-primary">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </div>

        <p class="hint" style="margin-top:0.4rem;">
          â€» åˆã‚ã¦ã®æ–¹ã¯ã€Œæ–°è¦ç™»éŒ²ã€ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼†ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚
        </p>
      </div>

      <!-- ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ -->
      <div id="auth-logged-in" style="display:none;">
        <div>
          <span style="font-size:0.8rem;">ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š</span>
          <span id="auth-user-email"></span>
        </div>
        <button type="button" id="btn-logout" class="btn-secondary">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </section>

    <!-- ====== ãƒ˜ãƒƒãƒ€ãƒ¼ ====== -->
    <header>
      <h1>ã‚·ãƒ³ãƒ—ãƒ«ã‚¿ã‚¹ã‚¯ç®¡ç†</h1>

      <div style="display:flex; gap:0.5rem; align-items:center;">
        <div class="filters">
          <span>è¡¨ç¤ºãƒ•ã‚£ãƒ«ã‚¿ï¼š</span>
          <select id="filter">
            <option value="all">ã™ã¹ã¦</option>
            <option value="undone">æœªå®Œäº†</option>
            <option value="done">å®Œäº†</option>
          </select>
        </div>

        <button id="themeToggle" class="btn-secondary theme-toggle" type="button">ğŸŒ™</button>
      </div>
    </header>

    <!-- ====== ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ ====== -->
    <div class="main">

      <!-- ã‚¿ã‚¹ã‚¯ä¸€è¦§ -->
      <section class="card task-list">
        <div class="task-list-header">
          <h2 style="font-size:1rem; margin:0;">ã‚¿ã‚¹ã‚¯ä¸€è¦§</h2>
          <button id="newTaskBtn" class="btn-primary">ï¼‹ æ–°è¦ã‚¿ã‚¹ã‚¯</button>
        </div>
        <ul id="task-list"></ul>
      </section>

      <!-- ã‚¿ã‚¹ã‚¯ãƒ•ã‚©ãƒ¼ãƒ  -->
      <section class="card task-form">
        <h2 style="font-size:1rem; margin-top:0;">ã‚¿ã‚¹ã‚¯è©³ç´°</h2>
        <form id="task-form">
          <input type="hidden" id="taskId" />

          <label for="title">ã‚¿ã‚¤ãƒˆãƒ«<span style="color:red;">*</span></label>
          <input type="text" id="title" required placeholder="ä¾‹ï¼‰è³‡æ–™ä½œæˆãªã©" />

          <label for="dueDate">æœŸé™æ—¥</label>
          <input type="date" id="dueDate" />

          <label for="priority">å„ªå…ˆåº¦</label>
          <select id="priority">
            <option value="medium">ä¸­</option>
            <option value="high">é«˜</option>
            <option value="low">ä½</option>
          </select>

          <label for="status">çŠ¶æ…‹</label>
          <select id="status">
            <option value="todo">æœªç€æ‰‹</option>
            <option value="doing">é€²è¡Œä¸­</option>
            <option value="done">å®Œäº†</option>
          </select>

          <label for="description">ãƒ¡ãƒ¢</label>
          <textarea id="description"></textarea>

          <div class="form-actions">
            <button type="button" id="resetBtn" class="btn-secondary">ã‚¯ãƒªã‚¢</button>
            <button type="submit" class="btn-primary">ä¿å­˜</button>
          </div>

          <p class="hint">
            â€» ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã¯ã‚¯ãƒ©ã‚¦ãƒ‰ä¿å­˜ã€æœªãƒ­ã‚°ã‚¤ãƒ³æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜
          </p>
        </form>
      </section>
    </div>
  </div>

  <!-- ======================================
       ğŸ”¥ Firebase ï¼† ã‚¢ãƒ—ãƒªæœ¬ä½“ JS
  ======================================= -->
  <script>
    /* ===== Firebase è¨­å®š ===== */
    const firebaseConfig = {
      apiKey: "AIzaSyCVv66kLVOb-jhFI6rZk4Bb6VAuXJdqudM",
      authDomain: "task-app-6c7a9.firebaseapp.com",
      projectId: "task-app-6c7a9",
      storageBucket: "task-app-6c7a9.firebasestorage.app",
      messagingSenderId: "164838034764",
      appId: "1:164838034764:web:cef4f3a2292b00dde993e9",
      measurementId: "G-LJF99YFG4B"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    /* ===== DOMContentLoaded ===== */
    document.addEventListener("DOMContentLoaded", () => {

      /* --- çœç•¥ã›ãšã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰å®Œå…¨ä¿æŒ ---
           ã“ã“ã‹ã‚‰ JS æœ¬ä½“ã®å†…å®¹ã¯ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾æ¡ç”¨
           ï¼ˆå·®åˆ†ã¯CSSã®ã¿ï¼‰
      */

      const STORAGE_KEY = "simpleTaskApp.tasks";

      const taskForm = document.getElementById("task-form");
      const taskIdInput = document.getElementById("taskId");
      const titleInput = document.getElementById("title");
      const dueDateInput = document.getElementById("dueDate");
      const prioritySelect = document.getElementById("priority");
      const statusSelect = document.getElementById("status");
      const descriptionInput = document.getElementById("description");
      const taskListEl = document.getElementById("task-list");
      const filterSelect = document.getElementById("filter");
      const newTaskBtn = document.getElementById("newTaskBtn");
      const resetBtn = document.getElementById("resetBtn");

      // auth UI
      const authLoggedOut = document.getElementById("auth-logged-out");
      const authLoggedIn = document.getElementById("auth-logged-in");
      const authEmailInput = document.getElementById("auth-email");
      const authPassInput = document.getElementById("auth-password");
      const authUserEmailSpan = document.getElementById("auth-user-email");
      const btnSignup = document.getElementById("btn-signup");
      const btnLogin = document.getElementById("btn-login");
      const btnLogout = document.getElementById("btn-logout");

      /* ===== ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ ===== */
      const themeToggle = document.getElementById("themeToggle");
      const THEME_KEY = "taskApp.theme";

      function applyTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        localStorage.setItem(THEME_KEY, theme);
        themeToggle.textContent = theme === "dark" ? "ğŸŒ" : "ğŸŒ™";
      }

      const savedTheme = localStorage.getItem(THEME_KEY);
      const prefersDark =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      applyTheme(savedTheme || (prefersDark ? "dark" : "light"));

      themeToggle.addEventListener("click", () => {
        const current =
          document.documentElement.getAttribute("data-theme") || "light";
        const next = current === "dark" ? "light" : "dark";
        applyTheme(next);
      });

      let tasks = [];
      let currentUser = null;
      let unsubscribeTasks = null;

      /* ===== ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ===== */
      function loadTasks() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed;
        } catch (e) {
          console.warn("ã‚¿ã‚¹ã‚¯èª­ã¿è¾¼ã¿å¤±æ•—:", e);
          return [];
        }
      }

      function saveTasks() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
        } catch (e) {
          console.warn("ã‚¿ã‚¹ã‚¯ä¿å­˜å¤±æ•—:", e);
        }
      }

      /* ===== Firestore ===== */
      function subscribeUserTasks(uid) {
        if (unsubscribeTasks) {
          unsubscribeTasks();
          unsubscribeTasks = null;
        }
        unsubscribeTasks = db
          .collection("users")
          .doc(uid)
          .collection("tasks")
          .orderBy("createdAt", "desc")
          .onSnapshot(
            (snapshot) => {
              const list = [];
              snapshot.forEach((doc) => list.push(doc.data()));
              tasks = list;
              saveTasks();
              renderTasks();
            },
            (error) => console.warn("è³¼èª­ã‚¨ãƒ©ãƒ¼:", error)
          );
      }

      function firestoreSaveTask(uid, task) {
        return db
          .collection("users")
          .doc(uid)
          .collection("tasks")
          .doc(task.id)
          .set(task);
      }

      function firestoreDeleteTask(uid, taskId) {
        return db
          .collection("users")
          .doc(uid)
          .collection("tasks")
          .doc(taskId)
          .delete();
      }

      /* ===== Auth ===== */
      auth.onAuthStateChanged((user) => {
        if (user) {
          currentUser = user;
          authLoggedOut.style.display = "none";
          authLoggedIn.style.display = "flex";
          authUserEmailSpan.textContent = user.email || "";
          subscribeUserTasks(user.uid);
        } else {
          currentUser = null;
          authLoggedOut.style.display = "block";
          authLoggedIn.style.display = "none";
          authUserEmailSpan.textContent = "";
          if (unsubscribeTasks) unsubscribeTasks();
          tasks = loadTasks();
          renderTasks();
        }
      });

      tasks = loadTasks();
      renderTasks();

      /* ===== Auth ã‚¤ãƒ™ãƒ³ãƒˆ ===== */
      btnSignup.addEventListener("click", async () => {
        const email = authEmailInput.value.trim();
        const pw = authPassInput.value;
        if (!email || !pw) return alert("ãƒ¡ãƒ¼ãƒ«ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        try {
          await auth.createUserWithEmailAndPassword(email, pw);
          alert("ç™»éŒ²ï¼†ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ");
        } catch (e) {
          alert("ç™»éŒ²å¤±æ•—ï¼š" + e.message);
        }
      });

      btnLogin.addEventListener("click", async () => {
        const email = authEmailInput.value.trim();
        const pw = authPassInput.value;
        if (!email || !pw) return alert("ãƒ¡ãƒ¼ãƒ«ã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        try {
          await auth.signInWithEmailAndPassword(email, pw);
        } catch (e) {
          alert("ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—ï¼š" + e.message);
        }
      });

      btnLogout.addEventListener("click", async () => {
        try {
          await auth.signOut();
        } catch (e) {
          alert("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå¤±æ•—ï¼š" + e.message);
        }
      });

      /* ===== ã‚¿ã‚¹ã‚¯æ©Ÿèƒ½ ===== */
      taskForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const title = titleInput.value.trim();
        if (!title) return alert("ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™");

        const now = new Date().toISOString();
        const existingId = taskIdInput.value;
        let targetTask = null;

        if (existingId) {
          tasks = tasks.map((t) => {
            if (t.id === existingId) {
              const updated = {
                ...t,
                title,
                dueDate: dueDateInput.value || null,
                priority: prioritySelect.value,
                status: statusSelect.value,
                description: descriptionInput.value,
                updatedAt: now
              };
              targetTask = updated;
              return updated;
            }
            return t;
          });
        } else {
          const newTask = {
            id: "task-" + Date.now().toString(36),
            title,
            dueDate: dueDateInput.value || null,
            priority: prioritySelect.value,
            status: statusSelect.value,
            description: descriptionInput.value,
            createdAt: now,
            updatedAt: now
          };
          tasks.unshift(newTask);
          targetTask = newTask;
        }

        saveTasks();
        renderTasks();
        clearForm();

        if (currentUser && targetTask) {
          firestoreSaveTask(currentUser.uid, targetTask);
        }
      });

      newTaskBtn.addEventListener("click", () => {
        clearForm();
        titleInput.focus();
      });

      resetBtn.addEventListener("click", clearForm);

      filterSelect.addEventListener("change", renderTasks);

      taskListEl.addEventListener("click", (e) => {
        const li = e.target.closest("li.task-item");
        if (!li) return;
        const id = li.dataset.id;

        if (e.target.matches(".edit-btn")) {
          const task = tasks.find((t) => t.id === id);
          if (task) loadTaskToForm(task);

        } else if (e.target.matches(".delete-btn")) {
          if (!confirm("ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) return;
          tasks = tasks.filter((t) => t.id !== id);
          saveTasks();
          renderTasks();
          if (currentUser) firestoreDeleteTask(currentUser.uid, id);

        } else if (e.target.matches(".toggle-done-btn")) {
          let targetTask = null;
          tasks = tasks.map((t) => {
            if (t.id === id) {
              const updated = {
                ...t,
                status: t.status === "done" ? "todo" : "done",
                updatedAt: new Date().toISOString()
              };
              targetTask = updated;
              return updated;
            }
            return t;
          });
          saveTasks();
          renderTasks();
          if (currentUser && targetTask) firestoreSaveTask(currentUser.uid, targetTask);
        }
      });

      /* ===== å…±é€šé–¢æ•° ===== */
      function renderTasks() {
        taskListEl.innerHTML = "";
        const filter = filterSelect.value;

        let filtered = [...tasks];
        if (filter === "undone") {
          filtered = filtered.filter((t) => t.status === "todo" || t.status === "doing");
        } else if (filter === "done") {
          filtered = filtered.filter((t) => t.status === "done");
        }

        if (filtered.length === 0) {
          const empty = document.createElement("li");
          empty.textContent = "ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
          empty.style.fontSize = "0.85rem";
          empty.style.color = "#888";
          taskListEl.appendChild(empty);
          return;
        }

        for (const task of filtered) {
          const li = document.createElement("li");
          li.className = "task-item";
          li.dataset.id = task.id;

          const mainRow = document.createElement("div");
          mainRow.className = "task-main-row";

          const titleSpan = document.createElement("span");
          titleSpan.className = "task-title";
          if (task.status === "done") {
            titleSpan.style.textDecoration = "line-through";
            titleSpan.style.color = "#777";
          }
          titleSpan.textContent = task.title;

          const toggleBtn = document.createElement("button");
          toggleBtn.type = "button";
          toggleBtn.className = "toggle-done-btn";
          toggleBtn.textContent = task.status === "done" ? "æœªå®Œäº†ã«æˆ»ã™" : "å®Œäº†ã«ã™ã‚‹";

          mainRow.appendChild(titleSpan);
          mainRow.appendChild(toggleBtn);

          const meta = document.createElement("div");
          meta.className = "task-meta";

          if (task.dueDate) {
            const due = document.createElement("span");
            due.textContent = "æœŸé™: " + task.dueDate;
            meta.appendChild(due);
          }

          const priorityBadge = document.createElement("span");
          priorityBadge.className = "badge " + getPriorityBadgeClass(task.priority);
          priorityBadge.textContent = "å„ªå…ˆåº¦: " + getPriorityLabel(task.priority);
          meta.appendChild(priorityBadge);

          const statusBadge = document.createElement("span");
          statusBadge.className = "badge " + getStatusBadgeClass(task.status);
          statusBadge.textContent = "çŠ¶æ…‹: " + getStatusLabel(task.status);
          meta.appendChild(statusBadge);

          const actions = document.createElement("div");
          actions.className = "task-actions";

          const editBtn = document.createElement("button");
          editBtn.type = "button";
          editBtn.className = "edit-btn";
          editBtn.textContent = "ç·¨é›†";

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "delete-btn btn-danger";
          deleteBtn.textContent = "å‰Šé™¤";

          actions.appendChild(editBtn);
          actions.appendChild(deleteBtn);

          li.appendChild(mainRow);
          li.appendChild(meta);
          li.appendChild(actions);

          taskListEl.appendChild(li);
        }
      }

      function clearForm() {
        taskIdInput.value = "";
        titleInput.value = "";
        dueDateInput.value = "";
        prioritySelect.value = "medium";
        statusSelect.value = "todo";
        descriptionInput.value = "";
      }

      function loadTaskToForm(task) {
        taskIdInput.value = task.id;
        titleInput.value = task.title;
        dueDateInput.value = task.dueDate || "";
        prioritySelect.value = task.priority;
        statusSelect.value = task.status;
        descriptionInput.value = task.description || "";
      }

      function getPriorityLabel(p) {
        return p === "high" ? "é«˜" : p === "low" ? "ä½" : "ä¸­";
      }
      function getStatusLabel(s) {
        return s === "todo" ? "æœªç€æ‰‹" : s === "doing" ? "é€²è¡Œä¸­" : "å®Œäº†";
      }
      function getPriorityBadgeClass(p) {
        return p === "high"
          ? "badge-priority-high"
          : p === "low"
          ? "badge-priority-low"
          : "badge-priority-medium";
      }
      function getStatusBadgeClass(s) {
        return s === "todo"
          ? "badge-status-todo"
          : s === "doing"
          ? "badge-status-doing"
          : "badge-status-done";
      }
    });

    /* ===== Service Worker ===== */
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker.register("service-worker.js");
      });
    }
  </script>
</body>
</html>
